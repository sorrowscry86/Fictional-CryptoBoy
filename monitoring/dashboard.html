<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoBoy Trading System - Real-Time Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #ffffff;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .header .subtitle {
            font-size: 1.2em;
            color: #a8d0ff;
        }

        .status-bar {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .status-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px 30px;
            border-radius: 8px;
            min-width: 150px;
            text-align: center;
            margin: 5px;
        }

        .status-item .label {
            font-size: 0.9em;
            color: #a8d0ff;
            margin-bottom: 5px;
        }

        .status-item .value {
            font-size: 1.8em;
            font-weight: bold;
        }

        .status-item.healthy .value {
            color: #4CAF50;
        }

        .status-item.warning .value {
            color: #FFC107;
        }

        .status-item.critical .value {
            color: #F44336;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .card h2 {
            font-size: 1.3em;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }

        .service-list {
            list-style: none;
        }

        .service-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            border-left: 4px solid transparent;
        }

        .service-item.running {
            border-left-color: #4CAF50;
        }

        .service-item.stopped {
            border-left-color: #F44336;
        }

        .service-item .name {
            font-weight: bold;
        }

        .service-item .status {
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8em;
            text-transform: uppercase;
        }

        .status.running {
            background: #4CAF50;
            color: white;
        }

        .status.stopped {
            background: #F44336;
            color: white;
        }

        .status.restarting {
            background: #FFC107;
            color: black;
        }

        .sentiment-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 12px;
            margin: 8px 0;
            border-radius: 5px;
            border-left: 4px solid transparent;
        }

        .sentiment-item.bullish {
            border-left-color: #4CAF50;
        }

        .sentiment-item.bearish {
            border-left-color: #F44336;
        }

        .sentiment-item.neutral {
            border-left-color: #9E9E9E;
        }

        .sentiment-item.stale {
            opacity: 0.6;
            border-left-color: #FFC107;
        }

        .sentiment-pair {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .sentiment-score {
            font-size: 1.2em;
        }

        .sentiment-score.bullish {
            color: #4CAF50;
        }

        .sentiment-score.bearish {
            color: #F44336;
        }

        .sentiment-headline {
            font-size: 0.85em;
            color: #a8d0ff;
            margin-top: 5px;
        }

        .queue-item {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            margin: 5px 0;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
        }

        .queue-item.backlog {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid #FFC107;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            margin: 5px 0;
        }

        .metric .label {
            color: #a8d0ff;
        }

        .metric .value {
            font-weight: bold;
        }

        .alerts {
            margin-top: 30px;
        }

        .alert {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 5px solid;
            animation: slideIn 0.3s ease-out;
        }

        .alert.warning {
            background: rgba(255, 193, 7, 0.2);
            border-left-color: #FFC107;
        }

        .alert.critical {
            background: rgba(244, 67, 54, 0.2);
            border-left-color: #F44336;
        }

        .alert .timestamp {
            font-size: 0.8em;
            color: #a8d0ff;
            margin-top: 5px;
        }

        @keyframes slideIn {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            z-index: 1000;
        }

        .connection-status.connected {
            background: #4CAF50;
            color: white;
        }

        .connection-status.disconnected {
            background: #F44336;
            color: white;
        }

        .last-update {
            text-align: center;
            color: #a8d0ff;
            margin-top: 20px;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .status-bar {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="connection-status" id="connectionStatus">Connecting...</div>

    <div class="header">
        <h1>ü§ñ CryptoBoy Trading System</h1>
        <div class="subtitle">Real-Time Monitoring Dashboard | VoidCat RDC</div>
    </div>

    <div class="status-bar">
        <div class="status-item" id="healthStatus">
            <div class="label">System Health</div>
            <div class="value">---%</div>
        </div>
        <div class="status-item" id="servicesStatus">
            <div class="label">Services Running</div>
            <div class="value">-- / --</div>
        </div>
        <div class="status-item" id="tradesStatus">
            <div class="label">Total Trades</div>
            <div class="value">--</div>
        </div>
        <div class="status-item" id="winRateStatus">
            <div class="label">Win Rate</div>
            <div class="value">--%</div>
        </div>
    </div>

    <div class="grid">
        <div class="card">
            <h2>üê≥ Docker Services</h2>
            <ul class="service-list" id="serviceList">
                <li class="service-item"><div class="name">Loading...</div></li>
            </ul>
        </div>

        <div class="card">
            <h2>üìä Sentiment Cache (Redis)</h2>
            <div id="sentimentList">
                <div style="text-align: center; padding: 20px; color: #a8d0ff;">
                    Loading sentiment data...
                </div>
            </div>
        </div>

        <div class="card">
            <h2>üê∞ RabbitMQ Queues</h2>
            <div id="queueList">
                <div style="text-align: center; padding: 20px; color: #a8d0ff;">
                    Loading queue data...
                </div>
            </div>
        </div>

        <div class="card">
            <h2>üíπ Trading Metrics</h2>
            <div id="tradingMetrics">
                <div class="metric">
                    <span class="label">Total Trades:</span>
                    <span class="value" id="totalTrades">--</span>
                </div>
                <div class="metric">
                    <span class="label">24h Trades:</span>
                    <span class="value" id="recentTrades">--</span>
                </div>
                <div class="metric">
                    <span class="label">Open Positions:</span>
                    <span class="value" id="openTrades">--</span>
                </div>
                <div class="metric">
                    <span class="label">Closed Trades:</span>
                    <span class="value" id="closedTrades">--</span>
                </div>
                <div class="metric">
                    <span class="label">Average Profit:</span>
                    <span class="value" id="avgProfit">--%</span>
                </div>
                <div class="metric">
                    <span class="label">Wins / Losses:</span>
                    <span class="value" id="winsLosses">-- / --</span>
                </div>
            </div>
        </div>
    </div>

    <div class="alerts">
        <div class="card">
            <h2>üö® Active Alerts</h2>
            <div id="alertsList">
                <div style="text-align: center; padding: 20px; color: #4CAF50;">
                    No active alerts - all systems operational
                </div>
            </div>
        </div>
    </div>

    <div class="last-update" id="lastUpdate">
        Last updated: --
    </div>

    <script>
        let ws = null;
        let reconnectInterval = null;

        function connectWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${window.location.host}/ws`;

            ws = new WebSocket(wsUrl);

            ws.onopen = () => {
                console.log('WebSocket connected');
                document.getElementById('connectionStatus').textContent = 'Connected';
                document.getElementById('connectionStatus').className = 'connection-status connected';

                if (reconnectInterval) {
                    clearInterval(reconnectInterval);
                    reconnectInterval = null;
                }
            };

            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                updateDashboard(data);
            };

            ws.onerror = (error) => {
                console.error('WebSocket error:', error);
            };

            ws.onclose = () => {
                console.log('WebSocket disconnected');
                document.getElementById('connectionStatus').textContent = 'Disconnected';
                document.getElementById('connectionStatus').className = 'connection-status disconnected';

                if (!reconnectInterval) {
                    reconnectInterval = setInterval(() => {
                        console.log('Attempting to reconnect...');
                        connectWebSocket();
                    }, 5000);
                }
            };
        }

        function updateDashboard(data) {
            updateStatusBar(data);
            updateServiceList(data.docker);
            updateSentimentCache(data.redis);
            updateQueueList(data.rabbitmq);
            updateTradingMetrics(data.trading);
            updateAlerts(data.alerts || []);
            updateLastUpdate(data.collection_timestamp);
        }

        function updateStatusBar(data) {
            const dockerSummary = data.docker?.summary || {};
            const tradingData = data.trading || {};

            // System health
            const health = dockerSummary.health_percentage || 0;
            const healthEl = document.getElementById('healthStatus');
            healthEl.querySelector('.value').textContent = `${health}%`;
            
            if (health === 100) {
                healthEl.className = 'status-item healthy';
            } else if (health >= 80) {
                healthEl.className = 'status-item warning';
            } else {
                healthEl.className = 'status-item critical';
            }

            // Services
            const running = dockerSummary.running || 0;
            const total = dockerSummary.total || 0;
            document.getElementById('servicesStatus').querySelector('.value').textContent = `${running} / ${total}`;

            // Trades
            const totalTrades = tradingData.total_trades || 0;
            document.getElementById('tradesStatus').querySelector('.value').textContent = totalTrades;

            // Win rate
            const winRate = tradingData.win_rate_pct || 0;
            const winRateEl = document.getElementById('winRateStatus');
            winRateEl.querySelector('.value').textContent = `${winRate}%`;
            
            if (winRate >= 50) {
                winRateEl.className = 'status-item healthy';
            } else if (winRate >= 40) {
                winRateEl.className = 'status-item warning';
            } else {
                winRateEl.className = 'status-item critical';
            }
        }

        function updateServiceList(dockerData) {
            if (!dockerData || !dockerData.containers) {
                return;
            }

            const serviceList = document.getElementById('serviceList');
            serviceList.innerHTML = '';

            const containers = dockerData.containers;
            for (const [name, info] of Object.entries(containers)) {
                const li = document.createElement('li');
                li.className = `service-item ${info.running ? 'running' : 'stopped'}`;

                const nameDiv = document.createElement('div');
                nameDiv.className = 'name';
                nameDiv.textContent = name.replace('trading-', '');

                const statusDiv = document.createElement('div');
                statusDiv.className = `status ${info.state}`;
                statusDiv.textContent = info.state;

                li.appendChild(nameDiv);
                li.appendChild(statusDiv);
                serviceList.appendChild(li);
            }
        }

        function updateSentimentCache(redisData) {
            if (!redisData || !redisData.sentiment_cache) {
                return;
            }

            const sentimentList = document.getElementById('sentimentList');
            sentimentList.innerHTML = '';

            const sentiments = redisData.sentiment_cache;
            for (const [pair, data] of Object.entries(sentiments)) {
                const div = document.createElement('div');
                const score = data.score;
                const classification = score > 0.3 ? 'bullish' : score < -0.3 ? 'bearish' : 'neutral';
                
                div.className = `sentiment-item ${classification} ${data.stale ? 'stale' : ''}`;

                div.innerHTML = `
                    <div class="sentiment-pair">
                        <span>${pair}</span>
                        <span class="sentiment-score ${classification}">${score >= 0 ? '+' : ''}${score.toFixed(2)}</span>
                    </div>
                    <div class="sentiment-headline">${data.headline || 'No recent news'}</div>
                    <div class="sentiment-headline" style="font-size: 0.75em;">
                        ${data.stale ? '‚ö†Ô∏è STALE - ' : ''}Age: ${data.age_hours.toFixed(1)}h
                    </div>
                `;

                sentimentList.appendChild(div);
            }
        }

        function updateQueueList(rabbitmqData) {
            if (!rabbitmqData || !rabbitmqData.queues) {
                return;
            }

            const queueList = document.getElementById('queueList');
            queueList.innerHTML = '';

            const queues = rabbitmqData.queues;
            for (const [name, data] of Object.entries(queues)) {
                const div = document.createElement('div');
                div.className = `queue-item ${data.backlog ? 'backlog' : ''}`;

                div.innerHTML = `
                    <span>${name}</span>
                    <span>${data.total_messages} msgs (${data.ready} ready, ${data.unacknowledged} unacked)</span>
                `;

                queueList.appendChild(div);
            }
        }

        function updateTradingMetrics(tradingData) {
            if (!tradingData) {
                return;
            }

            document.getElementById('totalTrades').textContent = tradingData.total_trades || 0;
            document.getElementById('recentTrades').textContent = tradingData.recent_trades_24h || 0;
            document.getElementById('openTrades').textContent = tradingData.open_trades || 0;
            document.getElementById('closedTrades').textContent = tradingData.closed_trades || 0;
            
            const avgProfit = tradingData.average_profit_pct || 0;
            const avgProfitEl = document.getElementById('avgProfit');
            avgProfitEl.textContent = `${avgProfit >= 0 ? '+' : ''}${avgProfit.toFixed(2)}%`;
            avgProfitEl.style.color = avgProfit >= 0 ? '#4CAF50' : '#F44336';

            document.getElementById('winsLosses').textContent = `${tradingData.wins || 0} / ${tradingData.losses || 0}`;
        }

        function updateAlerts(alerts) {
            const alertsList = document.getElementById('alertsList');

            if (!alerts || alerts.length === 0) {
                alertsList.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #4CAF50;">
                        ‚úì No active alerts - all systems operational
                    </div>
                `;
                return;
            }

            alertsList.innerHTML = '';

            alerts.forEach(alert => {
                const div = document.createElement('div');
                div.className = `alert ${alert.level}`;

                const timestamp = new Date(alert.timestamp).toLocaleString();

                div.innerHTML = `
                    <div><strong>${alert.level.toUpperCase()}:</strong> ${alert.message}</div>
                    <div class="timestamp">${timestamp}</div>
                `;

                alertsList.appendChild(div);
            });
        }

        function updateLastUpdate(timestamp) {
            if (!timestamp) return;

            const date = new Date(timestamp);
            document.getElementById('lastUpdate').textContent = `Last updated: ${date.toLocaleString()}`;
        }

        // Connect on page load
        connectWebSocket();
    </script>
</body>
</html>
